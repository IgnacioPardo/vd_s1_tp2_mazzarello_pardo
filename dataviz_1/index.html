<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ðŸš€ Misiones de Astronautas</title>
    <link rel="stylesheet" href="style.css" />
  </head>

  <body>

    <div id="dots" class="hidden">
        <div class="dot" id="worldTour_dot" onclick="navigate(this)"></div>
        <div class="dot" id="histogram_misions_per_year_dot" onclick="navigate(this)"></div>
        <div class="dot" id="histogram_hours_per_year_dot" onclick="navigate(this)"></div>
        <div class="dot" id="bar_gender_country_dot" onclick="navigate(this)"></div>
        <div class="dot" id="tree_dot" onclick="navigate(this)"></div>
    </div>

    <main>
      <h1 id="title"><b>Misiones de Astronautas</b></h1>
      <div id="intro">
        <button id="start" onclick="start()">ðŸš€ Explorar</button>
      </div>
      <div id="playground" class="hidden">
        
        <div id="worldTour" class="chart">
            <div id="worldTour_text">
                <div class="info_text" id="nombre"></div>
                <div class="info_text" id="nacionalidad"></div>
                <div class="info_text" id="anio_mision"></div>
                <div class="info_text" id="horas"></div>
            </div>
        </div>

        <div id="histogram_misions_per_year" class="chart">
          <center>
            <div class="info_text">Cantidad de Misiones por AÃ±o</div>
          </center>
          <div id="hist_chart"></div>
        </div>

        <div id="histogram_hours_per_year" class="chart">
          <center>
            <div class="info_text">Horas de Misiones por aÃ±o</div>
          </center>
          <div id="hist2_chart"></div>
        </div>

        <div id="bar_gender_country" class="chart">
          <center>
            <div class="info_text">Genero por Nacionalidad</div>
          </center>
          <div id="facet_chart"></div>
        </div>

        <div id="tree" class="chart">
          <center>
            <div class="info_text">Astronautas por paÃ­s por aÃ±o</div>
          </center>
          <div id="tree_chart"></div>
          <script>
            /* setTimeout(() => {
                        console.log("AAA")
                        var g = document.querySelector('[aria-label="text"]')
                        g.style.stroke = "unset"
                    }, 1000); */
          </script>
        </div>
      </div>
    </main>

    <footer class="hidden">
      <div id="footer_contents">
        <div id="footer_integrantes">
          <h1>Integrantes</h1>
          <p>Luca Mazzarello</p>
          <p>Ignacio Pardo</p>
        </div>
        <div id="footer_links">
          <div id="footer_icons">
            <a class="icon_ref" href="https://www.utdt.edu/">
              <img class="icon" src="utdt.svg" alt="UTDT" />
            </a>
            <a class="icon_ref" href="https://github.com">
              <img class="icon" src="gh.svg" alt="GitHub" />
            </a>
          </div>
          <!-- <a href="https://observablehq.com/">Observable</a> -->
        </div>
      </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script src="https://cdn.jsdelivr.net/npm/@observablehq/plot@0.6"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/iframe-resizer/4.3.2/iframeResizer.contentWindow.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/3.0.2/topojson.js"></script>
    <script src="https://unpkg.com/typed.js@2.0.132/dist/typed.umd.js"></script>
    <script src="script.js"></script>
    <script src="../dataviz_6/script.js"></script>
    <script src="../dataviz_7/script.js"></script>
    <script src="../dataviz_8/script.js"></script>
    <script src="../dataviz_9/script.js"></script>
    
    <script>

        var selected_dot;

        function check_dot(dot){
            console.log(dot);
            selected_dot.classList.remove("selected_dot");
            selected_dot.classList.add("dot");

            dot.classList.remove("dot");
            dot.classList.add("selected_dot");

            selected_dot = dot;
        }

        function navigate(e){
            check_dot(e);
            
            var id = e.id.split("_dot")[0];
            document.getElementById(id).scrollIntoView({
                behavior: 'smooth'
            });
        }

        function auto_check_dots(){
            var observer = new IntersectionObserver(function (entries) {
                if (entries[0].isIntersecting === true) {
                    
                    var id = entries[0].target.id;
                    var dot = document.getElementById(id + "_dot");
                    check_dot(dot);

                } else {
                    console.log('Item has just DISAPPEARED!');
                }
            }, { threshold: [0] });

            var charts = document.querySelectorAll(".chart");
            charts.forEach(chart => {               
                observer.observe(chart);
            });
            
            /* var charts = ["#worldTour", "#histogram_misions_per_year", "#histogram_hours_per_year", "#bar_gender_country", "#tree"];

            charts.forEach(chart => {
                observer.observe(document.querySelector(chart));
            }); */
        }

        function launchFullScreen(element) {
            if (element.requestFullScreen) {
                element.requestFullScreen();
            } else if (element.mozRequestFullScreen) {
                element.mozRequestFullScreen();
            } else if (element.webkitRequestFullScreen) {
                element.webkitRequestFullScreen();
            }
        }

        var state = false;

        function start() {
            if (!state) {
                new Audio("audio.mp3").play();
                launchFullScreen(document.documentElement);
                var intro = document.getElementById("intro");
                var playground = document.getElementById("playground");
                var footer = document.querySelector("footer");

                var dots = document.getElementById("dots");

                // animate playground opacity

                intro.style.display = "none";

                playground.classList.remove("hidden");
                playground.classList.add("visible");


                footer.classList.remove("hidden");
                footer.classList.add("visible");

                dots.classList.remove("hidden");
                dots.classList.add("visible");

                state = true;

                plot().then(() => {
                    
                    dots = document.querySelector("#dots");
                    first_dot = dots.children[0];
                    selected_dot = first_dot;
                    navigate(selected_dot);
                    auto_check_dots(); 
                    
                    console.log("PLOTED");
                });

            }
        }

        async function plot(){
            plotWorldTour();
            plotHist();
            plotHist2();
            plotTree();
            plotFacet();
        }
    </script>
  </body>
</html>
